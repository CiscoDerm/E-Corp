name: Check MkDocs Documentation

on:
  push:
    branches:
      - '*'
  pull_request:
    branches:
      - main

jobs:
  verify-docs:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout Repository
        uses: actions/checkout@v4

      - name: üèóÔ∏è Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: üì¶ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs mkdocs-material

      - name: üîé Run MkDocs Build Check
        id: build
        run: |
          echo "üõ†Ô∏è Checking MkDocs build..."
          mkdocs build | tee mkdocs_log.txt || echo "BUILD_FAILED=1" >> $GITHUB_ENV

      - name: üìñ Show MkDocs Logs
        run: cat mkdocs_log.txt || true

      - name: ‚ö†Ô∏è Check Log Length
        id: log_length
        run: |
          LOG_LINES=$(wc -l < mkdocs_log.txt)
          if [ "$LOG_LINES" -gt 3 ]; then
            echo "‚ö†Ô∏è MkDocs generated unexpected output! ($LOG_LINES lines)"
            echo "HAS_WARNINGS=1" >> $GITHUB_ENV
          fi

      - name: ‚ùó Detect Warnings
        id: warnings
        run: |
          if grep -i "WARNING" mkdocs_log.txt; then
            echo "‚ö†Ô∏è MkDocs built with warnings!"
            echo "HAS_WARNINGS=1" >> $GITHUB_ENV
          fi

      - name: ‚ùå Fail on Build Error
        if: env.BUILD_FAILED == '1'
        run: |
          echo "‚ùå MkDocs build failed! Check the logs above."
          exit 1

      - name: ‚úÖ Success Message
        if: env.BUILD_FAILED != '1' && env.HAS_WARNINGS != '1'
        run: echo "‚úÖ MkDocs build passed!"

      - name: ‚ö†Ô∏è Post Warning if Needed
        if: env.HAS_WARNINGS == '1'
        run: echo "‚ö†Ô∏è MkDocs generated warnings! Check logs."
